#ifndef _AP_SKILL_H_
#define _AP_SKILL_H_

#include "public/ap_base.h"
#include "public/ap_character.h"
#include "public/ap_define.h"
#include "public/ap_factors.h"

#include <assert.h>

#define AP_SKILL_MODULE_NAME "AgpmSkill"

#define AP_SKILL_MAX_SKILL_NAME_LENGTH 64

#define AP_SKILL_MAX_SKILLT_COMMENT 30
#define AP_SKILL_MAX_VISUAL_EFFECT_ID 10
#define AP_SKILL_TEMPLATE_DATA_COUNT 100
#define AP_SKILL_BTREE_ORDER 10
#define AP_SKILL_MAX_BUFF 10

#define AP_SKILL_MAX_SKILL_OWN 150

#define AP_SKILL_MAX_SKILL_BUFF 96
#define AP_SKILL_MAX_SKILL_USE 32

#define AP_SKILL_MAX_AFFECTED_BASE 50

#define AP_SKILL_MAX_SKILL_DESCRIPTION 255
#define AP_SKILL_MAX_SKILL_MINI_DESCRIPTION 255

#define AP_SKILL_MAX_DEFAULT_SKILL 5

#define AP_SKILL_MAX_SKILL_CONDITION 1

#define AP_SKILL_MAX_SKILL_CAP 21

#define AP_SKILL_MAX_TARGET 100

#define AP_SKILL_MAX_MASTERY 6
#define AP_SKILL_MAX_MASTERY_NAME 32
#define AP_SKILL_MAX_MASTERY_TREE_DEPTH 11

#define AP_SKILL_MAX_NUM_SKILL_NODE 3
#define AP_SKILL_MAX_MASTERY_SKILL 3

#define AP_SKILL_MAX_UPGRADE_SP 5

#define AP_SKILL_MAX_CONST_SPECIALIZE_IN_MASTERY 2
#define AP_SKILL_MAX_INSTANT_SPECIALIZE_IN_MASTERY 1
#define AP_SKILL_MAX_SPECIALIZE_LEVEL_POINT 6
#define AP_SKILL_MAX_SPECIALIZE_NAME 32
#define AP_SKILL_MAX_SPECIALIZE_DESCRIPTION 128
#define AP_SKILL_MAX_SPECIALIZE_RESTRICTION 128
#define AP_SKILL_MAX_SPECIALIZE_DURATION 2

#define AP_SKILL_MAX_STUN_DURATION 3000

#define AP_SKILL_MAX_TREE_NODE 250

#define AP_SKILL_MAX_TWICE_PACKET_BUFFER 3

#define AP_SKILL_MAX_CREATURE_TID_NUM 10
#define AP_SKILL_MAX_SKILL_LEVELUP_TID 10

#define AP_SKILL_TARGET_ENEMY_UNITS 0x00000001
#define AP_SKILL_TARGET_FRIENDLY_UNITS 0x00000002
#define AP_SKILL_TARGET_SELF_ONLY 0x00000004

#define AP_SKILL_CHECK_RANGE_NORMAL_RANGE 0x10000000
#define AP_SKILL_CHECK_RANGE_NOT_CHECK 0x20000000
#define AP_SKILL_CHECK_RANGE_SERVER_CONTROL 0x01000000

#define AP_SKILL_RANGE_BASE_SELF 0x40000000
#define AP_SKILL_RANGE_BASE_TARGET 0x80000000

#define AP_SKILL_RANGE_SPHERE 0x00000001
#define AP_SKILL_RANGE_BOX 0x00000002
#define AP_SKILL_RANGE_TARGET_ONLY 0x00000004
#define AP_SKILL_RANGE_SELF_ONLY 0x00000008
#define AP_SKILL_RANGE_SUMMONS_ONLY 0x00000010

#define AP_SKILL_RANGE_SPHERE_USE_ATK_RANGE 0x00010000
#define AP_SKILL_RANGE_SPHERE_USE_CONSTANT 0x00020000
#define AP_SKILL_RANGE_SPHERE_INVOLVE_SELF 0x00040000
#define AP_SKILL_RANGE_SPHERE_ONLY_PARTY_MEMBER 0x00080000
#define AP_SKILL_RANGE_SPHERE_ONLY_ENEMY_UNITS 0x00100000
#define AP_SKILL_RANGE_SPHERE_ONLY_FRIENDLY_UNITS 0x00200000
#define AP_SKILL_RANGE_SPHERE_ONLY_UNDEAD_UNITS 0x00400000
#define AP_SKILL_RANGE_SPHERE_ONLY_SUMMONS 0x00800000
#define AP_SKILL_RANGE_TARGET_ONLY_INVOLVE_SELF 0x01000000
#define AP_SKILL_RANGE_TARGET_ONLY_ENEMY_UNITS 0x02000000
#define AP_SKILL_RANGE_TARGET_ONLY_FRIENDLY_UNITS 0x04000000
#define AP_SKILL_RANGE_BOX_ONLY_ENEMY_UNITS 0x08000000

#define AP_SKILL_RANGE2_SIEGE_WAR_TO_ALL_ATTACKERS 0x00000001
#define AP_SKILL_RANGE2_SIEGE_WAR_TO_ALL_DEFENDERS 0x00000002
#define AP_SKILL_RANGE2_GROUND 0x00000004
#define AP_SKILL_RANGE2_ONLY_ENEMY_UNITS 0x00000008
#define AP_SKILL_RANGE2_ONLY_GUILD_MEMBERS 0x00000010
#define AP_SKILL_RANGE2_TARGET_DEAD 0x00000020
#define AP_SKILL_RANGE2_TARGET_RACE 0x00000040
#define AP_SKILL_RANGE2_TARGET_PARTY 0x00000080
#define AP_SKILL_RANGE2_TARGET_REGION 0x00000100
#define AP_SKILL_RANGE2_TARGET_REGION_INVOLVE_PARENT 0x00000200
#define AP_SKILL_RANGE2_SPHERE 0x10000000


#define AP_SKILL_REQUIREMENT_EQUIP_WEAPON 0x00000001
#define AP_SKILL_REQUIREMENT_EQUIP_ARROW 0x00000002
#define AP_SKILL_REQUIREMENT_EQUIP_SHIELD 0x00000004
#define AP_SKILL_REQUIREMENT_EQUIP_PRODUCT_TOOL 0x00000008
#define AP_SKILL_REQUIREMENT_EQUIP_ONE_HAND_SWORD 0x00000010
#define AP_SKILL_REQUIREMENT_EQUIP_ONE_HAND_AXE 0x00000020
#define AP_SKILL_REQUIREMENT_EQUIP_BLUNT 0x00000040
#define AP_SKILL_REQUIREMENT_EQUIP_TWO_HAND_SLASH 0x00000080
#define AP_SKILL_REQUIREMENT_EQUIP_STAFF 0x00000100
#define AP_SKILL_REQUIREMENT_EQUIP_WAND 0x00000200
#define AP_SKILL_REQUIREMENT_EQUIP_BOW 0x00000400
#define AP_SKILL_REQUIREMENT_EQUIP_CROSS_BOW 0x00000800
#define AP_SKILL_REQUIREMENT_EQUIP_KATARIYA 0x00001000
#define AP_SKILL_REQUIREMENT_EQUIP_CHAKRAM 0x00002000
#define AP_SKILL_REQUIREMENT_EQUIP_LEFT_HAND_SWORD 0x00004000
#define AP_SKILL_REQUIREMENT_EQUIP_RIGHT_WEAPON_ONLY 0x00008000
#define AP_SKILL_REQUIREMENT_EQUIP_CHARON 0x00010000
#define AP_SKILL_REQUIREMENT_EQUIP_ZENON 0x00020000
#define AP_SKILL_REQUIREMENT_EQUIP_CHARON_AND_ZENON 0x00040000


#define AP_SKILL_CONDITION_SKIP_CHECK_FIRST 0x10000000
#define AP_SKILL_CONDITION_SKIP_TARGET_NOT_IN_RANGE 0x20000000
#define AP_SKILL_CONDITION_SERVER_CONTROL 0x40000000

#define AP_SKILL_CONDITION_MELEE_ATTACK 0x00000001
#define AP_SKILL_CONDITION_DEBUFF 0x00000002
#define AP_SKILL_CONDITION_FRIENDLY_UNIT 0x00000004
#define AP_SKILL_CONDITION_MAGIC_ATTACK 0x00000008
#define AP_SKILL_CONDITION_LEVEL 0x00000010
#define AP_SKILL_CONDITION_KILL_GUARDIAN 0x00000020
#define AP_SKILL_CONDITION_CHAR_TYPE 0x00000040
#define AP_SKILL_CONDITION_OWN_ITEM 0x00000080
#define AP_SKILL_CONDITION_PARTY_MEMBER 0x00000100
#define AP_SKILL_CONDITION_SHOUT_WORD 0x00000200

#define AP_SKILL_CONDITION_MELEE_ATTACK_USE_AP_CONST 0x00010000
#define AP_SKILL_CONDITION_MELEE_ATTACK_REDUCE_HITRATE 0x00020000
#define AP_SKILL_CONDITION_MELEE_ATTACK_EQUIP_WEAPON 0x00040000
#define AP_SKILL_CONDITION_MELEE_ATTACK_EQUIP_ARROW 0x00080000
#define AP_SKILL_CONDITION_MELEE_ATTACK_EQUIP_SHIELD 0x00100000
#define AP_SKILL_CONDITION_MELEE_ATTACK_USE_FORMULA1 0x00200000

#define AP_SKILL_CONDITION_MAGIC_ATTACK_USE_FORMULA1 0x00010000
#define AP_SKILL_CONDITION_MAGIC_ATTACK_USE_FORMULA2 0x00020000

#define AP_SKILL_CONDITION2_START_ON_RESURRECTION 0x00000001
#define AP_SKILL_CONDITION2_RELY_ON_REGION 0x00000002
#define AP_SKILL_CONDITION2_DONT_USE_BY_CASH 0x00000004

#define AP_SKILL_COST_HP 0x00000001
#define AP_SKILL_COST_MP 0x00000002
#define AP_SKILL_COST_SP 0x00000004
#define AP_SKILL_COST_ARROW 0x00000008

#define AP_SKILL_SPECIAL_STATUS_STUN 0x0000000000000001
#define AP_SKILL_SPECIAL_STATUS_FREEZE 0x0000000000000002
#define AP_SKILL_SPECIAL_STATUS_SLOW 0x0000000000000004
#define AP_SKILL_SPECIAL_STATUS_INVINCIBLE 0x0000000000000008
#define AP_SKILL_SPECIAL_STATUS_ATTRIBUTE_INVINCIBLE 0x0000000000000010
#define AP_SKILL_SPECIAL_STATUS_NOT_ADD_AGRO 0x0000000000000020
#define AP_SKILL_SPECIAL_STATUS_HIDE_AGRO 0x0000000000000040
#define AP_SKILL_SPECIAL_STATUS_STUN_PROTECT 0x0000000000000080
#define AP_SKILL_SPECIAL_STATUS_PVP_INVINCIBLE 0x0000000000000100
#define AP_SKILL_SPECIAL_STATUS_TRANSPARENT 0x0000000000000200
#define AP_SKILL_SPECIAL_STATUS_HALT 0x0000000000000400
#define AP_SKILL_SPECIAL_STATUS_HALF_TRANSPARENT 0x0000000000000800
#define AP_SKILL_SPECIAL_STATUS_NORMAL_ATK_INVINCIBLE 0x0000000000001000
#define AP_SKILL_SPECIAL_STATUS_SKILL_ATK_INVINCIBLE 0x0000000000002000
#define AP_SKILL_SPECIAL_STATUS_DISABLE_SKILL 0x0000000000004000
#define AP_SKILL_SPECIAL_STATUS_DISABLE_NORMAL_ATK 0x0000000000008000
#define AP_SKILL_SPECIAL_STATUS_SLEEP 0x0000000000010000
#define AP_SKILL_SPECIAL_STATUS_SLOW_INVINCIBLE 0x0000000000020000
#define AP_SKILL_SPECIAL_STATUS_DISARMAMENT 0x0000000000040000
#define AP_SKILL_SPECIAL_STATUS_DISABLE_CHATTING 0x0000000000080000
#define AP_SKILL_SPECIAL_STATUS_HOLD 0x0000000000100000
#define AP_SKILL_SPECIAL_STATUS_CONFUSION 0x0000000000200000
#define AP_SKILL_SPECIAL_STATUS_FEAR 0x0000000000400000
#define AP_SKILL_SPECIAL_STATUS_DISEASE 0x0000000000800000
#define AP_SKILL_SPECIAL_STATUS_BERSERK 0x0000000001000000
#define AP_SKILL_SPECIAL_STATUS_SHRINK 0x0000000002000000


#define AP_SKILL_EFFECT_PROCESS_INTERVAL_FLAG 0x0100000000000000
#define AP_SKILL_EFFECT_PROCESS_INTERVAL_VALUE 10000

#define AP_SKILL_EFFECT_MELEE_ATTACK_DMG 0x0000000000000001
#define AP_SKILL_EFFECT_MAGIC_ATTACK_DMG 0x0000000000000002
#define AP_SKILL_EFFECT_COUNT 0x0000000000000004
#define AP_SKILL_EFFECT_SPECIAL_STATUS 0x0000000000000008
#define AP_SKILL_EFFECT_MOVE_TARGET 0x0000000000000010
#define AP_SKILL_EFFECT_UPDATE_FACTOR 0x0000000000000020
#define AP_SKILL_EFFECT_REFLECT_MELEE_ATTACK 0x0000000000000040
#define AP_SKILL_EFFECT_REFLECT_MAGIC_ATTACK 0x0000000000000080
#define AP_SKILL_EFFECT_REFLECT_HEROIC_ATTACK 0x0020000000000000
#define AP_SKILL_EFFECT_DEFENSE_MELEE_ATTACK 0x0000000000000100
#define AP_SKILL_EFFECT_DEFENSE_MAGIC_ATTACK 0x0000000000000200
#define AP_SKILL_EFFECT_MAGIC_RESIST_LEVEL_UP 0x0000000000000400
#define AP_SKILL_EFFECT_DISPEL_MAGIC 0x0000000000000800
#define AP_SKILL_EFFECT_TRANSFORM_TARGET 0x0000000000001000
#define AP_SKILL_EFFECT_LIFE_PROTECTION 0x0000000000002000
#define AP_SKILL_EFFECT_DOT_DAMAGE 0x0000000000004000
#define AP_SKILL_EFFECT_INFECT_AROUND 0x0000000000008000
#define AP_SKILL_EFFECT_ADD_SPELLCOUNT 0x0000000000010000
#define AP_SKILL_EFFECT_DMG_ADJUST 0x0000000000020000
#define AP_SKILL_EFFECT_SKILL_FACTOR_ADJUST 0x0000000000040000

#define AP_SKILL_EFFECT_MELEE_ATTACK_DMG_TYPE1 0x0000000000080000
#define AP_SKILL_EFFECT_MELEE_ATTACK_DMG_TYPE2 0x0000000000100000
#define AP_SKILL_EFFECT_MELEE_ATTACK_DMG_TYPE3 0x0000000000200000
#define AP_SKILL_EFFECT_MELEE_ATTACK_CRITICAL 0x0000000000400000
#define AP_SKILL_EFFECT_MELEE_ATTACK_DEATH 0x0000000000800000
#define AP_SKILL_EFFECT_MELEE_ATTACK_DMG_TYPE6 0x0000000001000000
#define AP_SKILL_EFFECT_MELEE_ATTACK_DURABILITY 0x0000000002000000
#define AP_SKILL_EFFECT_MELEE_ATTACK_HEROIC 0x0000000004000000

#define AP_SKILL_EFFECT_MAGIC_ATTACK_DMG_ADJUST_FLAG 1000
#define AP_SKILL_EFFECT_MAGIC_ATTACK_DMG_ADJUST 0x0000000002000000

#define AP_SKILL_EFFECT_MAGIC_ATTACK_CRITICAL 0x0000000004000000

#define AP_SKILL_EFFECT_REFLECT_RECEIVED_DAMAGE 0x0000000008000000
#define AP_SKILL_EFFECT_REFLECT_DAMAGE_SHIELD 0x0000000010000000

#define AP_SKILL_EFFECT_DEFENSE_COUNTER_ATTACK 0x0000000020000000
#define AP_SKILL_EFFECT_DEFENSE_EVADE 0x0000000040000000

#define AP_SKILL_EFFECT_UPDATE_FACTOR_MAGNIFY 0x0000000080000000
#define AP_SKILL_EFFECT_UPDATE_FACTOR_HOT 0x0000000100000000
#define AP_SKILL_EFFECT_UPDATE_FACTOR_FOR_A_WHILE 0x0000000200000000
#define AP_SKILL_EFFECT_UPDATE_FACTOR_ITEM 0x0000000400000000
#define AP_SKILL_EFFECT_UPDATE_FACTOR_TIME 0x0000000800000000

#define AP_SKILL_EFFECT_ADD_SPELLCOUNT_MASTERY_POINT 0x0000001000000000

#define AP_SKILL_EFFECT_SKILL_FACTOR_ADJUST_COST_HP 0x0000002000000000
#define AP_SKILL_EFFECT_SKILL_FACTOR_ADJUST_COST_MP 0x0000004000000000
#define AP_SKILL_EFFECT_SKILL_FACTOR_ADJUST_COST_SP 0x0000008000000000
#define AP_SKILL_EFFECT_SKILL_FACTOR_ADJUST_RANGE 0x0000010000000000
#define AP_SKILL_EFFECT_SKILL_FACTOR_ADJUST_CAST_TIME 0x0000020000000000
#define AP_SKILL_EFFECT_SKILL_FACTOR_ADJUST_DURATION_TIME 0x0000040000000000
#define AP_SKILL_EFFECT_SKILL_FACTOR_ADJUST_BUFFED_SKILL_DURATION 0x0000080000000000
#define AP_SKILL_EFFECT_SKILL_FACTOR_ADJUST_MODIFIED_SKILL_DURATION 0x0000100000000000

#define AP_SKILL_EFFECT_TRANSFORM_TARGET_TYPE1 0x0000080000000000
#define AP_SKILL_EFFECT_TRANSFORM_TARGET_TYPE2 0x0000100000000000
#define AP_SKILL_EFFECT_TRANSFORM_TARGET_TYPE3 0x0000200000000000
#define AP_SKILL_EFFECT_TRANSFORM_TARGET_TYPE4 0x0000400000000000
#define AP_SKILL_EFFECT_TRANSFORM_TARGET_TYPE5 0x0008000000000000

#define AP_SKILL_EFFECT_DOT_DAMAGE_PHYSICAL 0x0000800000000000
#define AP_SKILL_EFFECT_DOT_DAMAGE_ATTRIBUTE 0x0001000000000000
#define AP_SKILL_EFFECT_DOT_DAMAGE_HEROIC 0x0010000000000000

#define AP_SKILL_EFFECT_DISPEL_MAGIC_CURE 0x0002000000000000

#define AP_SKILL_EFFECT_CRITICAL_DEFENCE_PERCENT 0x0004000000000000

#define AP_SKILL_EFFECT2_UPDATE_COMBAT_POINT 0x0000000000000001
#define AP_SKILL_EFFECT2_REGEN_HP 0x0000000000000002
#define AP_SKILL_EFFECT2_REGEN_MP 0x0000000000000004
#define AP_SKILL_EFFECT2_CONVERT 0x0000000000000008
#define AP_SKILL_EFFECT2_CHARGE 0x0000000000000010
#define AP_SKILL_EFFECT2_SKILL_LEVELUP 0x0000000000000020
#define AP_SKILL_EFFECT2_PRODUCT 0x0000000000000040

#define AP_SKILL_EFFECT2_TWICE_PACKET 0x0000000000000080
#define AP_SKILL_EFFECT2_DYNAMIC_TARGET 0x0000000000000100
#define AP_SKILL_EFFECT2_ACTOIN_ON_ACTION 0x0000000000000200
#define AP_SKILL_EFFECT2_AT_FIELD 0x0000000000000400
#define AP_SKILL_EFFECT2_SUMMONS 0x0000000000000800
#define AP_SKILL_EFFECT2_ACTION_PASSIVE 0x0000000000001000
#define AP_SKILL_EFFECT2_DURATION_TYPE 0x0000000000002000
#define AP_SKILL_EFFECT2_RELEASE_TARGET 0x0000000000004000
#define AP_SKILL_EFFECT2_VISIBLE_EFFECT_TYPE 0x0000000000008000
#define AP_SKILL_EFFECT2_GAME_BONUS 0x0000000000010000
#define AP_SKILL_EFFECT2_ITEM_USE_TYPE 0x0000000000020000
#define AP_SKILL_EFFECT2_CASH 0x0000000000040000
#define AP_SKILL_EFFECT2_LEVEL_DIFF_TYPE 0x0000000000080000
#define AP_SKILL_EFFECT2_DETECT 0x0000000000100000
#define AP_SKILL_EFFECT2_RIDE 0x0000000000200000
#define AP_SKILL_EFFECT2_GAME_EFFECT 0x0000000000400000
#define AP_SKILL_EFFECT2_FORCE 0x0000000000800000
#define AP_SKILL_EFFECT2_DIVIDE 0x0000000001000000
#define AP_SKILL_EFFECT2_RESURRECTION 0x0000000002000000
#define AP_SKILL_EFFECT2_SKILL_UNION 0x0000000004000000
#define AP_SKILL_EFFECT2_MOVE_POS 0x0000000008000000
#define AP_SKILL_EFFECT2_TARGET_RESTRICTION 0x0000000010000000
#define AP_SKILL_EFFECT2_DISTURB_CHARACTER_ACTION 0x0000000020000000
#define AP_SKILL_EFFECT2_TOLERANCE_DISTURB_CHARACTER_ACTION 0x0000000040000000

#define AP_SKILL_ENDSKILL_CONSUME_HP 0x0000000000000001

#define AP_SKILL_EFFECT_DETAIL_UPDATE_COMBAT_POINT_TYPE1 0x0001
#define AP_SKILL_EFFECT_DETAIL_UPDATE_COMBAT_POINT_TYPE2 0x0002
#define AP_SKILL_EFFECT_DETAIL_UPDATE_COMBAT_POINT_TYPE3 0x0004

#define AP_SKILL_EFFECT_DETAIL_CONVERT_DAMAGE_TO_HP 0x0001
#define AP_SKILL_EFFECT_DETAIL_CONVERT_DAMAGE_TO_MP 0x0002
#define AP_SKILL_EFFECT_DETAIL_CONVERT_MP_TO_HP 0x0004
#define AP_SKILL_EFFECT_DETAIL_CONVERT_ATK_DAMAGE_TO_HP 0x0008
#define AP_SKILL_EFFECT_DETAIL_CONVERT_ATK_DAMAGE_TO_MP 0x0010
#define AP_SKILL_EFFECT_DETAIL_CONVERT_ATK_DAMAGE_TO_HP_INSTANT 0x0020

#define AP_SKILL_EFFECT_DETAIL_SKILL_LEVELUP_TYPE1 0x0001
#define AP_SKILL_EFFECT_DETAIL_SKILL_LEVELUP_TYPE2 0x0002
#define AP_SKILL_EFFECT_DETAIL_SKILL_LEVELUP_TYPE3 0x0004

#define AP_SKILL_EFFECT_DETAIL_TWICE_PACKET_BY_DISTANCE 0x0001
#define AP_SKILL_EFFECT_DETAIL_TWICE_PACKET_BY_STATIC_TIME 0x0002

#define AP_SKILL_EFFECT_DETAIL_ACTION_ON_ACTION_TYPE1 0x0001
#define AP_SKILL_EFFECT_DETAIL_ACTION_ON_ACTION_TYPE2 0x0002
#define AP_SKILL_EFFECT_DETAIL_ACTION_ON_ACTION_TYPE3 0x0004
#define AP_SKILL_EFFECT_DETAIL_ACTION_ON_ACTION_TYPE4 0x0008
#define AP_SKILL_EFFECT_DETAIL_ACTION_ON_ACTION_TYPE5 0x0010
#define AP_SKILL_EFFECT_DETAIL_ACTION_ON_ACTION_TYPE6 0x0020
#define AP_SKILL_EFFECT_DETAIL_ACTION_ON_ACTION_TYPE7 0x0040
#define AP_SKILL_EFFECT_DETAIL_ACTION_ON_ACTION_TYPE8 0x0080


#define AP_SKILL_EFFECT_DETAIL_AT_FIELD_ATTACK 0x0001
#define AP_SKILL_EFFECT_DETAIL_AT_FIELD_ATTACK2 0x0002
#define AP_SKILL_EFFECT_DETAIL_AT_FIELD_AURA 0x0004

#define AP_SKILL_EFFECT_DETAIL_SUMMONS_TYPE1 0x0001
#define AP_SKILL_EFFECT_DETAIL_SUMMONS_TYPE2 0x0002
#define AP_SKILL_EFFECT_DETAIL_SUMMONS_TYPE3 0x0004
#define AP_SKILL_EFFECT_DETAIL_SUMMONS_TYPE4 0x0008
#define AP_SKILL_EFFECT_DETAIL_SUMMONS_TYPE5 0x0010
#define AP_SKILL_EFFECT_DETAIL_SUMMONS_TYPE6 0x0020
#define AP_SKILL_EFFECT_DETAIL_SUMMONS_TYPE7 0x0040
#define AP_SKILL_EFFECT_DETAIL_SUMMONS_TYPE8 0x0080
#define AP_SKILL_EFFECT_DETAIL_SUMMONS_TYPE9 0x0100
#define AP_SKILL_EFFECT_DETAIL_SUMMONS_TYPE10 0x0200

#define AP_SKILL_EFFECT_DETAIL_DURATION_TYPE1 0x0001
#define AP_SKILL_EFFECT_DETAIL_DURATION_TYPE2 0x0002

#define AP_SKILL_EFFECT_DETAIL_GAME_BONUS_EXP 0x0001
#define AP_SKILL_EFFECT_DETAIL_GAME_BONUS_MONEY 0x0002
#define AP_SKILL_EFFECT_DETAIL_GAME_BONUS_DROP_RATE 0x0004
#define AP_SKILL_EFFECT_DETAIL_GAME_BONUS_DROP_RATE2 0x0008
#define AP_SKILL_EFFECT_DETAIL_GAME_BONUS_CHARISMA_RATE 0x0010

#define AP_SKILL_EFFECT_DETAIL_GAME_EFFECT_DAY_NIGHT 0X0001
#define AP_SKILL_EFFECT_DETAIL_GAME_EFFECT_RAIN 0x0002
#define AP_SKILL_EFFECT_DETAIL_GAME_EFFECT_SNOW 0x0004

#define AP_SKILL_EFFECT_DETAIL_FORCE_SUMMON_LIMIT     0x0001
#define AP_SKILL_EFFECT_DETAIL_FORCE_WITHOUT_TARGET   0x0002
#define AP_SKILL_EFFECT_DETAIL_FORCE_INVISIBLE_COMBAT 0x0004

#define AP_SKILL_EFFECT_DETAIL_DISPEL_STUN 0x0004
#define AP_SKILL_EFFECT_DETAIL_DISPEL_SLOW 0x0008
#define AP_SKILL_EFFECT_DETAIL_DISPEL_ALL_BUFF 0x0010
#define AP_SKILL_EFFECT_DETAIL_DISPEL_TRANSPARENT 0x0020
#define AP_SKILL_EFFECT_DETAIL_DISPEL_SPECIAL_STATUS 0x0040

#define AP_SKILL_EFFECT_DETAIL_DIVIDE_ATTR 0x0001
#define AP_SKILL_EFFECT_DETAIL_DIVIDE_NORMAL 0x0002

#define AP_SKILL_EFFECT_DETAIL_DETECT_TYPE1 0x0001
#define AP_SKILL_EFFECT_DETAIL_DETECT_TYPE2 0x0002

#define AP_SKILL_EFFECT_DETAIL_SKILL_UNION_TYPE1 0x0001
#define AP_SKILL_EFFECT_DETAIL_SKILL_UNION_TYPE2 0x0002

#define AP_SKILL_EFFECT_DETAIL_MOVE_POS_TARGET 0x0001
#define AP_SKILL_EFFECT_DETAIL_MOVE_POS_SELF 0x0002
#define AP_SKILL_EFFECT_DETAIL_MOVE_POS_TARGET_TO_ME 0x0004

#define AP_SKILL_EFFECT_DETAIL_REFLECT_MELEE_ATK_IGNORE_PHYSICAL 0x0004
#define AP_SKILL_EFFECT_DETAIL_REFLECT_MELEE_ATK_IGNORE_ATTRIBUTE 0x0008

#define AP_SKILL_EFFECT_DETAIL_TARGET_RESTRICTION_SIEGE_OBJECT 0x0001
#define AP_SKILL_EFFECT_DETAIL_TARGET_RESTRICTION_MONSTER 0x0002
#define AP_SKILL_EFFECT_DETAIL_TARGET_RESTRICTION_ENEMY_PC 0x0004

#define AP_SKILL_EFFECT_DETAIL_DISTURB_CHARACTER_ACTION_NONE 0x0000
#define AP_SKILL_EFFECT_DETAIL_DISTURB_CHARACTER_ACTION_ATTACK 0x0001
#define AP_SKILL_EFFECT_DETAIL_DISTURB_CHARACTER_ACTION_MOVE 0x0002
#define AP_SKILL_EFFECT_DETAIL_DISTURB_CHARACTER_ACTION_USE_ITEM 0x0004
#define AP_SKILL_EFFECT_DETAIL_DISTURB_CHARACTER_ACTION_SKILL 0x0008

#define	AP_SKILL_BELOW_LEVEL_SKILL_NAME "(이전스킬)"

#define AP_SKILL_ATTRIBUTE_PHYSICAL_DMG      0x00000001
#define AP_SKILL_ATTRIBUTE_MAGIC_DMG_MAGIC   0x00000002
#define AP_SKILL_ATTRIBUTE_MAGIC_DMG_FIRE    0x00000004
#define AP_SKILL_ATTRIBUTE_MAGIC_DMG_EARTH   0x00000008
#define AP_SKILL_ATTRIBUTE_MAGIC_DMG_AIR     0x00000010
#define AP_SKILL_ATTRIBUTE_MAGIC_DMG_WATER   0x00000020
#define AP_SKILL_ATTRIBUTE_BUFF              0x00000100
#define AP_SKILL_ATTRIBUTE_DEBUFF            0x00000200
#define AP_SKILL_ATTRIBUTE_PASSIVE           0X00000400
#define AP_SKILL_ATTRIBUTE_SUMMONS           0x00000800
#define AP_SKILL_ATTRIBUTE_TYPE_MAGIC        0x00001000
#define AP_SKILL_ATTRIBUTE_PRODUCT           0x00002000
#define AP_SKILL_ATTRIBUTE_NOT_SEND_CAST     0x00004000
#define AP_SKILL_ATTRIBUTE_ETC               0x00008000
#define AP_SKILL_ATTRIBUTE_CAN_UPGRADE       0x00010000
#define AP_SKILL_ATTRIBUTE_CANNOT_UPGRADE    0x00020000
#define AP_SKILL_ATTRIBUTE_LIMITED_MAX_LEVEL 0x00040000
#define AP_SKILL_ATTRIBUTE_SAVE_EXPIREDATE   0x00080000
#define AP_SKILL_ATTRIBUTE_SAVE_DURATION     0x00100000

#define AP_SKILL_TOOLTIP_BASIC_ATTR_LEVEL 0x0000000000000001
#define AP_SKILL_TOOLTIP_BASIC_ATTR_TYPE 0x0000000000000002
#define AP_SKILL_TOOLTIP_BASIC_ATTR_DETAIL_TYPE 0x0000000000000004
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CLASS_KNIGHT 0x0000000000000008
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CLASS_ARCHER 0x0000000000000010
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CLASS_WIZARD 0x0000000000000020
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CLASS_BERSERKER 0x0000000000000040
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CLASS_HUNTER 0x0000000000000080
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CLASS_SORCERER 0x0000000000000100
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CLASS_ASSASSIN 0x0000000000000200
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CLASS_RANGER 0x0000000000000400
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CLASS_ELEMENTALLIST 0x0000000000000800
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CLASS_SLAYER 0x0000000000001000
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CLASS_SCOUTER 0x0000000000002000
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CLASS_SUMMONER 0x0000000000004000
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CLASS_SCION 0x0000000000008000
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_LEVEL 0x0000000000010000
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_POINT 0x0000000000020000

#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_HEROIC 0x0000000000040000
#define AP_SKILL_TOOLTIP_BASIC_ATTR_REQUIRE_CHARISMA 0x0000000000080000

#define AP_SKILL_TOOLTIP_CAST_TIME 0x0000000000000001 
#define AP_SKILL_TOOLTIP_RECAST_TIME 0x0000000000000002
#define AP_SKILL_TOOLTIP_DURATION 0x0000000000000004
#define AP_SKILL_TOOLTIP_RANGE_DISTANCE 0x0000000000000008
#define AP_SKILL_TOOLTIP_RANGE_RADIUS 0x0000000000000010
#define AP_SKILL_TOOLTIP_RANGE_BOX_X 0x0000000000000020
#define AP_SKILL_TOOLTIP_RANGE_BOX_Y 0x0000000000000040
#define AP_SKILL_TOOLTOP_INTERVAL 0x0000000000000080

#define AP_SKILL_TOOLTIP_COST_HP 0x0000000000000001
#define AP_SKILL_TOOLTIP_COST_MP 0x0000000000000002
#define AP_SKILL_TOOLTIP_COST_ARROW 0x0000000000000004
#define AP_SKILL_TOOLTIP_ENDSKILL_COST_HP 0x0000000000000008

#define AP_SKILL_TOOLTIP_DAMAGE_PHYSICAL 0x0000000000000001
#define AP_SKILL_TOOLTIP_DAMAGE_MAGIC 0x0000000000000002
#define AP_SKILL_TOOLTIP_DAMAGE_WATER 0x0000000000000004
#define AP_SKILL_TOOLTIP_DAMAGE_AIR 0x0000000000000008
#define AP_SKILL_TOOLTIP_DAMAGE_EARTH 0x0000000000000010
#define AP_SKILL_TOOLTIP_DAMAGE_FIRE 0x0000000000000020
#define AP_SKILL_TOOLTIP_DAMAGE_POISON 0x0000000000000040
#define AP_SKILL_TOOLTIP_DAMAGE_ICE 0x0000000000000080
#define AP_SKILL_TOOLTIP_DAMAGE_LIGHTENING 0x0000000000000100

#define AP_SKILL_TOOLTIP_DOT_DAMAGE_PHYSICAL 0x0000000000000200
#define AP_SKILL_TOOLTIP_DOT_DAMAGE_MAGIC 0x0000000000000400
#define AP_SKILL_TOOLTIP_DOT_DAMAGE_WATER 0x0000000000000800
#define AP_SKILL_TOOLTIP_DOT_DAMAGE_AIR 0x0000000000001000
#define AP_SKILL_TOOLTIP_DOT_DAMAGE_EARTH 0x0000000000002000
#define AP_SKILL_TOOLTIP_DOT_DAMAGE_FIRE 0x0000000000004000
#define AP_SKILL_TOOLTIP_DOT_DAMAGE_POISON 0x0000000000008000
#define AP_SKILL_TOOLTIP_DOT_DAMAGE_ICE 0x0000000000010000
#define AP_SKILL_TOOLTIP_DOT_DAMAGE_LIGHTENING 0x0000000000020000

#define AP_SKILL_TOOLTIP_DAMAGE_PERCENT_PHYSICAL 0x0000000000100000
#define AP_SKILL_TOOLTIP_DAMAGE_PERCENT_MAGIC 0x0000000000200000
#define AP_SKILL_TOOLTIP_DAMAGE_PERCENT_WATER 0x0000000000400000
#define AP_SKILL_TOOLTIP_DAMAGE_PERCENT_AIR 0x0000000000800000
#define AP_SKILL_TOOLTIP_DAMAGE_PERCENT_EARTH 0x0000000001000000
#define AP_SKILL_TOOLTIP_DAMAGE_PERCENT_FIRE 0x0000000002000000
#define AP_SKILL_TOOLTIP_DAMAGE_PERCENT_POISON 0x0000000004000000
#define AP_SKILL_TOOLTIP_DAMAGE_PERCENT_ICE 0x0000000008000000
#define AP_SKILL_TOOLTIP_DAMAGE_PERCENT_LIGHTENING 0x0000000010000000

#define AP_SKILL_TOOLTIP_DAMAGE_HEROIC 0x0000000020000000
#define AP_SKILL_TOOLTIP_DAMAGE_PERCENT_HEROIC 0x0000000040000000
#define AP_SKILL_TOOLTIP_DOT_DAMAGE_HEROIC 0x0000000080000000

#define AP_SKILL_TOOLTIP_MOVE_DISTANCE 0x0000000000000001
#define AP_SKILL_TOOLTIP_REFLECT_DAMAGE 0x0000000000000002
#define AP_SKILL_TOOLTIP_BLOCK_RATE 0x0000000000000004
#define AP_SKILL_TOOLTIP_STUN_TIME 0x0000000000000008
#define AP_SKILL_TOOLTIP_HIT_RATE 0x0000000000000010
#define AP_SKILL_TOOLTIP_CRITICAL 0x0000000000000020
#define AP_SKILL_TOOLTIP_ADJUST_SKILL_RANGE 0x0000000000000040
#define AP_SKILL_TOOLTIP_DURABILITY 0x0000000000000080
#define AP_SKILL_TOOLTIP_QUANTITY_ITEM 0x0000000000000100
#define AP_SKILL_TOOLTIP_SKILL_RATE 0x0000000000000200
#define AP_SKILL_TOOLTIP_DAMAGE_CONVERT_HP 0x0000000000000400
#define AP_SKILL_TOOLTIP_DAMAGE_CONVERT_MP 0x0000000000000800
#define AP_SKILL_TOOLTIP_MP_CONVERT_HP 0x0000000000001000
#define AP_SKILL_TOOLTIP_REGEN_HP 0x0000000000002000
#define AP_SKILL_TOOLTIP_REGEN_MP 0x0000000000004000
#define AP_SKILL_TOOLTIP_CHARGE_DAMAGE_1 0x0000000000008000
#define AP_SKILL_TOOLTIP_CHARGE_DAMAGE_2 0x0000000000010000
#define AP_SKILL_TOOLTIP_CHARGE_DAMAGE_3 0x0000000000020000
#define AP_SKILL_TOOLTIP_AGRODOLL_HP 0x0000000000040000
#define AP_SKILL_TOOLTIP_DOT_INTERVAL 0x0000000000080000
#define AP_SKILL_TOOLTIP_DECREASE_COST_MP 0x0000000000100000
#define AP_SKILL_TOOLTIP_DECREASE_CAST_TIME 0x0000000000200000
#define AP_SKILL_TOOLTIP_ADJUST_SKILL_LEVEL 0x0000000000400000
#define AP_SKILL_TOOLTIP_LEARN_COST 0x0000000000800000
#define AP_SKILL_TOOLTIP_DEATH 0x0000000001000000
#define AP_SKILL_TOOLTIP_SUMMONS 0x0000000002000000
#define AP_SKILL_TOOLTIP_ADDITIONAL_DURATION 0x0000000004000000
#define AP_SKILL_TOOLTIP_MAX_TARGET_NUM 0x0000000008000000
#define AP_SKILL_TOOLTIP_LIMIT_QUANTITY 0x0000000010000000
#define AP_SKILL_TOOLTIP_SUMMONS_COUNT 0x0000000020000000
#define AP_SKILL_TOOLTIP_BONUS_EXP 0x0000000040000000
#define AP_SKILL_TOOLTIP_BONUS_MONEY 0x0000000080000000
#define AP_SKILL_TOOLTIP_BONUS_DROP_RATE 0x0000000100000000
#define AP_SKILL_TOOLTIP_BONUS_DIVIDE_RATE 0x0000000200000000

#define AP_SKILL_TOOLTIP_EA_DMG_POINT_PHYSICAL 0x0000000400000000
#define AP_SKILL_TOOLTIP_EA_DMG_POINT_MAGIC 0x0000000800000000
#define AP_SKILL_TOOLTIP_EA_DMG_POINT_WATER 0x0000001000000000
#define AP_SKILL_TOOLTIP_EA_DMG_POINT_AIR 0x0000002000000000
#define AP_SKILL_TOOLTIP_EA_DMG_POINT_EARTH 0x0000004000000000
#define AP_SKILL_TOOLTIP_EA_DMG_POINT_FIRE 0x0000008000000000
#define AP_SKILL_TOOLTIP_EA_DMG_POINT_POISON 0x0000010000000000
#define AP_SKILL_TOOLTIP_EA_DMG_POINT_ICE 0x0000020000000000
#define AP_SKILL_TOOLTIP_EA_DMG_POINT_LIGHTENING 0x0000040000000000

#define AP_SKILL_TOOLTIP_RATE_CRITICAL_ACTIVITY 0x0010000000000000
#define AP_SKILL_TOOLTIP_RATE_STUN_ACTIVITY 0x0020000000000000
#define AP_SKILL_TOOLTIP_EFFECT_SUMMONS_QUANTITY 0x0040000000000000
#define AP_SKILL_TOOLTIP_ADJUST_SUMMON_LEVEL 0x0080000000000000

#define AP_SKILL_TOOLTIP_STUN_GENERATE_TIME 0x0100000000000000
#define AP_SKILL_TOOLTIP_TIME_CONTROL 0x0200000000000000
#define AP_SKILL_TOOLTIP_ITEM_PART 0x0400000000000000

#define AP_SKILL_TOOLTIP_FACTOR_POINT_CON 0x0000000000000001
#define AP_SKILL_TOOLTIP_FACTOR_POINT_STR 0x0000000000000002
#define AP_SKILL_TOOLTIP_FACTOR_POINT_INT 0x0000000000000004
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEX 0x0000000000000008
#define AP_SKILL_TOOLTIP_FACTOR_POINT_CHA 0x0000000000000010
#define AP_SKILL_TOOLTIP_FACTOR_POINT_WIS 0x0000000000000020
#define AP_SKILL_TOOLTIP_FACTOR_POINT_MOVEMENT 0x0000000000000040
#define AP_SKILL_TOOLTIP_FACTOR_POINT_HP 0x0000000000000080
#define AP_SKILL_TOOLTIP_FACTOR_POINT_MP 0x0000000000000100
#define AP_SKILL_TOOLTIP_FACTOR_POINT_AGRO 0x0000000000000200
#define AP_SKILL_TOOLTIP_FACTOR_POINT_MAX_HP 0x0000000000000400
#define AP_SKILL_TOOLTIP_FACTOR_POINT_MAX_MP 0x0000000000000800
#define AP_SKILL_TOOLTIP_FACTOR_POINT_ATK_SPEED 0x0000000000001000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_ATK_RANGE 0x0000000000002000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_SKILL_CAST 0x0000000000004000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_SKILL_DELAY 0x0000000000008000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_HIT_RATE 0x0000000000010000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_EVADE_RATE 0x0000000000020000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DODGE_RATE 0x0000000000040000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MIN_PHYSICAL 0x0000000000080000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MIN_MAGIC 0x0000000000100000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MIN_WATER 0x0000000000200000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MIN_AIR 0x0000000000400000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MIN_EARTH 0x0000000000800000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MIN_FIRE 0x0000000001000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MIN_POISON 0x0000000002000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MIN_ICE 0x0000000004000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MIN_LIGHTENING 0x0000000008000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MAX_PHYSICAL 0x0000000010000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MAX_MAGIC 0x0000000020000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MAX_WATER 0x0000000040000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MAX_AIR 0x0000000080000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MAX_EARTH 0x0000000100000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MAX_FIRE 0x0000000200000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MAX_POISON 0x0000000400000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MAX_ICE 0x0000000800000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MAX_LIGHTENING 0x0000001000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEF_POINT_PHYSICAL 0x0000002000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEF_POINT_MAGIC 0x0000004000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEF_POINT_WATER 0x0000008000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEF_POINT_AIR 0x0000010000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEF_POINT_EARTH 0x0000020000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEF_POINT_FIRE 0x0000040000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEF_POINT_POISON 0x0000080000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEF_POINT_ICE 0x0000100000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEF_POINT_LIGHTENING 0x0000200000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEF_RATE_PHYSICAL 0x0000400000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEF_RATE_PHYSICAL_BLOCK 0x0000800000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEF_RATE_SKILL_BLOCK 0x0001000000000000

#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MIN_HEROIC 0x0002000000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DMG_MAX_HEROIC 0x0004000000000000
#define AP_SKILL_TOOLTIP_FACTOR_POINT_DEF_POINT_HEROIC 0x0008000000000000

#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_CON 0x0000000000000001
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_STR 0x0000000000000002
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_INT 0x0000000000000004
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEX 0x0000000000000008
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_CHA 0x0000000000000010
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_WIS 0x0000000000000020
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_MOVEMENT 0x0000000000000040
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_HP 0x0000000000000080
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_MP 0x0000000000000100
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_AGRO 0x0000000000000200
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_MAX_HP 0x0000000000000400
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_MAX_MP 0x0000000000000800
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_ATK_SPEED 0x0000000000001000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_ATK_RANGE 0x0000000000002000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_SKILL_CAST 0x0000000000004000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_SKILL_DELAY 0x0000000000008000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_HIT_RATE 0x0000000000010000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_EVADE_RATE 0x0000000000020000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DODGE_RATE 0x0000000000040000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MIN_PHYSICAL 0x0000000000080000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MIN_MAGIC 0x0000000000100000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MIN_WATER 0x0000000000200000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MIN_AIR 0x0000000000400000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MIN_EARTH 0x0000000000800000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MIN_FIRE 0x0000000001000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MIN_POISON 0x0000000002000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MIN_ICE 0x0000000004000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MIN_LIGHTENING 0x0000000008000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MAX_PHYSICAL 0x0000000010000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MAX_MAGIC 0x0000000020000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MAX_WATER 0x0000000040000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MAX_AIR 0x0000000080000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MAX_EARTH 0x0000000100000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MAX_FIRE 0x0000000200000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MAX_POISON 0x0000000400000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MAX_ICE 0x0000000800000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DMG_MAX_LIGHTENING 0x0000001000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_POINT_PHYSICAL 0x0000002000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_POINT_MAGIC 0x0000004000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_POINT_WATER 0x0000008000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_POINT_AIR 0x0000010000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_POINT_EARTH 0x0000020000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_POINT_FIRE 0x0000040000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_POINT_POISON 0x0000080000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_POINT_ICE 0x0000100000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_POINT_LIGHTENING 0x0000200000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_RATE_PHYSICAL 0x0000400000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_RATE_PHYSICAL_BLOCK 0x0000800000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_RATE_SKILL_BLOCK 0x0001000000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_IGNORE_PHYSICAL 0x0002000000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_IGNORE_ATTRIBUTE 0x0004000000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_CRITICAL 0x0008000000000000

#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_POINT_MEELEHEROIC_RESISTANCE 0x0010000000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_POINT_RANGEHEROIC_RESISTANCE 0x0020000000000000
#define AP_SKILL_TOOLTIP_FACTOR_PERCENT_DEF_POINT_MAGICHEROIC_RESISTANCE 0x0040000000000000

BEGIN_DECLS

struct ap_skill_module;

enum ap_skill_buff_type {
	AP_SKILL_BUFF_JOIN_PARTY		= 1,
	AP_SKILL_BUFF_PARTY_AC_UP		= 2,
	AP_SKILL_BUFF_PARTY_DMB_UP		= 3
};

enum ap_skill_used_const_factor {
	AP_SKILL_CONST_POINT_START = 0,
	AP_SKILL_CONST_POINT_CON,
	AP_SKILL_CONST_POINT_STR,
	AP_SKILL_CONST_POINT_INT,
	AP_SKILL_CONST_POINT_DEX,
	AP_SKILL_CONST_POINT_CHA,
	AP_SKILL_CONST_POINT_WIS,
	AP_SKILL_CONST_POINT_MOVEMENT,
	AP_SKILL_CONST_POINT_MOVEMENT_FAST,
	AP_SKILL_CONST_POINT_HP,
	AP_SKILL_CONST_POINT_MP,
	AP_SKILL_CONST_POINT_SP,
	AP_SKILL_CONST_POINT_AP,
	AP_SKILL_CONST_POINT_AGRO,
	AP_SKILL_CONST_POINT_HP_MAX,
	AP_SKILL_CONST_POINT_MP_MAX,
	AP_SKILL_CONST_POINT_SP_MAX,
	AP_SKILL_CONST_POINT_ATK_SPEED,
	AP_SKILL_CONST_POINT_ATK_RANGE,
	AP_SKILL_CONST_POINT_SKILL_CAST,
	AP_SKILL_CONST_POINT_SKILL_DELAY,
	AP_SKILL_CONST_POINT_HIT_RATE,
	AP_SKILL_CONST_POINT_EVADE_RATE,
	AP_SKILL_CONST_POINT_DODGE_RATE,
	AP_SKILL_CONST_POINT_DMG_MIN_PHYSICAL,
	AP_SKILL_CONST_POINT_DMG_MIN_MAGIC,
	AP_SKILL_CONST_POINT_DMG_MIN_WATER,
	AP_SKILL_CONST_POINT_DMG_MIN_AIR,
	AP_SKILL_CONST_POINT_DMG_MIN_EARTH,
	AP_SKILL_CONST_POINT_DMG_MIN_FIRE,
	AP_SKILL_CONST_POINT_DMG_MIN_POISON,
	AP_SKILL_CONST_POINT_DMG_MIN_ICE,
	AP_SKILL_CONST_POINT_DMG_MIN_LIGHTENING,
	AP_SKILL_CONST_POINT_DMG_MIN_HEROIC,
	AP_SKILL_CONST_POINT_DMG_MAX_PHYSICAL,
	AP_SKILL_CONST_POINT_DMG_MAX_MAGIC,
	AP_SKILL_CONST_POINT_DMG_MAX_WATER,
	AP_SKILL_CONST_POINT_DMG_MAX_AIR,
	AP_SKILL_CONST_POINT_DMG_MAX_EARTH,
	AP_SKILL_CONST_POINT_DMG_MAX_FIRE,
	AP_SKILL_CONST_POINT_DMG_MAX_POISON,
	AP_SKILL_CONST_POINT_DMG_MAX_ICE,
	AP_SKILL_CONST_POINT_DMG_MAX_LIGHTENING,
	AP_SKILL_CONST_POINT_DMG_MAX_HEROIC,
	AP_SKILL_CONST_POINT_DEF_POINT_PHYSICAL,
	AP_SKILL_CONST_POINT_DEF_POINT_MAGIC,
	AP_SKILL_CONST_POINT_DEF_POINT_WATER,
	AP_SKILL_CONST_POINT_DEF_POINT_AIR,
	AP_SKILL_CONST_POINT_DEF_POINT_EARTH,
	AP_SKILL_CONST_POINT_DEF_POINT_FIRE,
	AP_SKILL_CONST_POINT_DEF_POINT_POISON,
	AP_SKILL_CONST_POINT_DEF_POINT_ICE,
	AP_SKILL_CONST_POINT_DEF_POINT_LIGHTENING,
	AP_SKILL_CONST_POINT_DEF_POINT_HEROIC,
	AP_SKILL_CONST_POINT_DEF_RATE_PHYSICAL,
	AP_SKILL_CONST_POINT_DEF_RATE_PHYSICAL_BLOCK,
	AP_SKILL_CONST_POINT_DEF_RATE_SKILL_BLOCK,
	AP_SKILL_CONST_POINT_DEF_RATE_HEROIC_MELEE,
	AP_SKILL_CONST_POINT_DEF_RATE_HEROIC_RANGED,
	AP_SKILL_CONST_POINT_DEF_RATE_HEROIC_MAGIC,
	AP_SKILL_CONST_POINT_END,
	AP_SKILL_CONST_PERCENT_START,
	AP_SKILL_CONST_PERCENT_CON,
	AP_SKILL_CONST_PERCENT_STR,
	AP_SKILL_CONST_PERCENT_INT,
	AP_SKILL_CONST_PERCENT_DEX,
	AP_SKILL_CONST_PERCENT_CHA,
	AP_SKILL_CONST_PERCENT_WIS,
	AP_SKILL_CONST_PERCENT_MOVEMENT,
	AP_SKILL_CONST_PERCENT_MOVEMENT_FAST,
	AP_SKILL_CONST_PERCENT_HP,
	AP_SKILL_CONST_PERCENT_MP,
	AP_SKILL_CONST_PERCENT_SP,
	AP_SKILL_CONST_PERCENT_AP,
	AP_SKILL_CONST_PERCENT_AGRO,
	AP_SKILL_CONST_PERCENT_HP_MAX,
	AP_SKILL_CONST_PERCENT_MP_MAX,
	AP_SKILL_CONST_PERCENT_SP_MAX,
	AP_SKILL_CONST_PERCENT_ATKSPEED,
	AP_SKILL_CONST_PERCENT_ATKRANGE,
	AP_SKILL_CONST_PERCENT_SKILL_CAST,
	AP_SKILL_CONST_PERCENT_SKILL_DELAY,
	AP_SKILL_CONST_PERCENT_HIT_RATE,
	AP_SKILL_CONST_PERCENT_EVADE_RATE,
	AP_SKILL_CONST_PERCENT_DODGE_RATE,
	AP_SKILL_CONST_PERCENT_DMG_MIN_PHYSICAL,
	AP_SKILL_CONST_PERCENT_DMG_MIN_MAGIC,
	AP_SKILL_CONST_PERCENT_DMG_MIN_WATER,
	AP_SKILL_CONST_PERCENT_DMG_MIN_AIR,
	AP_SKILL_CONST_PERCENT_DMG_MIN_EARTH,
	AP_SKILL_CONST_PERCENT_DMG_MIN_FIRE,
	AP_SKILL_CONST_PERCENT_DMG_MIN_POISON,
	AP_SKILL_CONST_PERCENT_DMG_MIN_ICE,
	AP_SKILL_CONST_PERCENT_DMG_MIN_LIGHTENING,
	AP_SKILL_CONST_PERCENT_DMG_MIN_HEROIC,
	AP_SKILL_CONST_PERCENT_DMG_MAX_PHYSICAL,
	AP_SKILL_CONST_PERCENT_DMG_MAX_MAGIC,
	AP_SKILL_CONST_PERCENT_DMG_MAX_WATER,
	AP_SKILL_CONST_PERCENT_DMG_MAX_AIR,
	AP_SKILL_CONST_PERCENT_DMG_MAX_EARTH,
	AP_SKILL_CONST_PERCENT_DMG_MAX_FIRE,
	AP_SKILL_CONST_PERCENT_DMG_MAX_POISON,
	AP_SKILL_CONST_PERCENT_DMG_MAX_ICE,
	AP_SKILL_CONST_PERCENT_DMG_MAX_LIGHTENING,
	AP_SKILL_CONST_PERCENT_DMG_MAX_HEROIC,
	AP_SKILL_CONST_PERCENT_DEF_POINT_PHYSICAL,
	AP_SKILL_CONST_PERCENT_DEF_POINT_MAGIC,
	AP_SKILL_CONST_PERCENT_DEF_POINT_WATER,
	AP_SKILL_CONST_PERCENT_DEF_POINT_AIR,
	AP_SKILL_CONST_PERCENT_DEF_POINT_EARTH,
	AP_SKILL_CONST_PERCENT_DEF_POINT_FIRE,
	AP_SKILL_CONST_PERCENT_DEF_POINT_POISON,
	AP_SKILL_CONST_PERCENT_DEF_POINT_ICE,
	AP_SKILL_CONST_PERCENT_DEF_POINT_LIGHTENING,
	AP_SKILL_CONST_PERCENT_DEF_POINT_HEROIC,
	AP_SKILL_CONST_PERCENT_DEF_RATE_PHYSICAL,
	AP_SKILL_CONST_PERCENT_DEF_RATE_PHYSICAL_BLOCK,
	AP_SKILL_CONST_PERCENT_DEF_RATE_SKILL_BLOCK,
	AP_SKILL_CONST_PERCENT_DEF_RATE_HEROIC_MELEE,
	AP_SKILL_CONST_PERCENT_DEF_RATE_HEROIC_RANGED,
	AP_SKILL_CONST_PERCENT_DEF_RATE_HEROIC_MAGIC,
	AP_SKILL_CONST_PERCENT_END,
	AP_SKILL_CONST_MAGNIFY_START,
	AP_SKILL_CONST_MAGNIFY_MOVEMENT,
	AP_SKILL_CONST_MAGNIFY_ATKSPEED,
	AP_SKILL_CONST_MAGNIFY_END,
	AP_SKILL_CONST_SKILL_TYPE,
	AP_SKILL_CONST_SKILL_TYPE2,
	AP_SKILL_CONST_BUFF_TYPE,
	AP_SKILL_CONST_REQUIRE_CLASS_KNIGHT,
	AP_SKILL_CONST_REQUIRE_CLASS_ARCHER,
	AP_SKILL_CONST_REQUIRE_CLASS_WIZARD,
	AP_SKILL_CONST_REQUIRE_CLASS_BERSERKER,
	AP_SKILL_CONST_REQUIRE_CLASS_HUNTER,
	AP_SKILL_CONST_REQUIRE_CLASS_SORCERER,
	AP_SKILL_CONST_REQUIRE_CLASS_SWASHBUCKLER,
	AP_SKILL_CONST_REQUIRE_CLASS_RANGER,
	AP_SKILL_CONST_REQUIRE_CLASS_ELEMENTALER,
	AP_SKILL_CONST_REQUIRE_CLASS_SLAYER,
	AP_SKILL_CONST_REQUIRE_CLASS_OBITER,
	AP_SKILL_CONST_REQUIRE_CLASS_SUMMONER,
	AP_SKILL_CONST_REQUIRE_CLASS_SCION,
	AP_SKILL_CONST_REQUIRE_LEVEL,
	AP_SKILL_CONST_REQUIRE_POINT,
	AP_SKILL_CONST_SKILL_LEVEL,
	AP_SKILL_CONST_DAMAGE_A,
	AP_SKILL_CONST_DAMAGE_MAGIC,
	AP_SKILL_CONST_DAMAGE_WATER,
	AP_SKILL_CONST_DAMAGE_AIR,
	AP_SKILL_CONST_DAMAGE_EARTH,
	AP_SKILL_CONST_DAMAGE_FIRE,
	AP_SKILL_CONST_DAMAGE_POISON,
	AP_SKILL_CONST_DAMAGE_ICE,
	AP_SKILL_CONST_DAMAGE_THUNDER,
	AP_SKILL_CONST_DAMAGE_C,
	AP_SKILL_CONST_DAMAGE_A_PERCENT,
	AP_SKILL_CONST_DAMAGE_MAGIC_PERCENT,
	AP_SKILL_CONST_DAMAGE_WATER_PERCENT,
	AP_SKILL_CONST_DAMAGE_AIR_PERCENT,
	AP_SKILL_CONST_DAMAGE_EARTH_PERCENT,
	AP_SKILL_CONST_DAMAGE_FIRE_PERCENT,
	AP_SKILL_CONST_DAMAGE_POISON_PERCENT,
	AP_SKILL_CONST_DAMAGE_ICE_PERCENT,
	AP_SKILL_CONST_DAMAGE_THUNDER_PERCENT,
	AP_SKILL_CONST_DAMAGE_C_PERCENT,
	AP_SKILL_CONST_RESIST_A,
	AP_SKILL_CONST_COST_HP,
	AP_SKILL_CONST_COST_MP,
	AP_SKILL_CONST_COST_SP,
	AP_SKILL_CONST_COST_ARROW,
	AP_SKILL_CONST_ENDSKILL_COST_HP,
	AP_SKILL_CONST_CAST_TIME,
	AP_SKILL_CONST_RECAST_TIME,
	AP_SKILL_CONST_SEMI_RECAST_TIME,
	AP_SKILL_CONST_DURATION,
	AP_SKILL_CONST_INTERVAL,
	AP_SKILL_CONST_SHOW_DAMAGE,
	AP_SKILL_CONST_RANGE,
	AP_SKILL_CONST_TARGET_AREA_R,
	AP_SKILL_CONST_TARGET_AREA_F1,
	AP_SKILL_CONST_TARGET_AREA_F2,
	AP_SKILL_CONST_DOT_DMG_A,
	AP_SKILL_CONST_DOT_DMG_MAGIC,
	AP_SKILL_CONST_DOT_DMG_WATER,
	AP_SKILL_CONST_DOT_DMG_AIR,
	AP_SKILL_CONST_DOT_DMG_EARTH,
	AP_SKILL_CONST_DOT_DMG_FIRE,
	AP_SKILL_CONST_DOT_DMG_POISON,
	AP_SKILL_CONST_DOT_DMG_ICE,
	AP_SKILL_CONST_DOT_DMG_THUNDER,
	AP_SKILL_CONST_DOT_DMG_HEROIC,
	AP_SKILL_CONST_DOT_DMG_A_PERCENT,
	AP_SKILL_CONST_DOT_DMG_MAGIC_PERCENT,
	AP_SKILL_CONST_DOT_DMG_WATER_PERCENT,
	AP_SKILL_CONST_DOT_DMG_AIR_PERCENT,
	AP_SKILL_CONST_DOT_DMG_EARTH_PERCENT,
	AP_SKILL_CONST_DOT_DMG_FIRE_PERCENT,
	AP_SKILL_CONST_DOT_DMG_POISON_PERCENT,
	AP_SKILL_CONST_DOT_DMG_ICE_PERCENT,
	AP_SKILL_CONST_DOT_DMG_THUNDER_PERCENT,
	AP_SKILL_CONST_DOT_DMG_HEROIC_PERCENT,
	AP_SKILL_CONST_MOVE_DISTANCE,
	AP_SKILL_CONST_REFLECT_MAX,
	AP_SKILL_CONST_HEROIC_REFLECT_MAX,
	AP_SKILL_CONST_DEFENSE_MAX,
	AP_SKILL_CONST_REFLECT_CON,
	AP_SKILL_CONST_DEFENSE_CON,
	AP_SKILL_CONST_DAMAGE_SHIELD,
	AP_SKILL_CONST_COUNTER_UP,
	AP_SKILL_CONST_COUNTER_REDUCE,
	AP_SKILL_CONST_HOT,
	AP_SKILL_CONST_DMG_ADJUST,
	AP_SKILL_CONST_DMG_SHOW_DIVIDE,
	AP_SKILL_CONST_HP_RECOVERY,
	AP_SKILL_CONST_MP_RECOVERY,
	AP_SKILL_CONST_SP_RECOVERY,
	AP_SKILL_CONST_WARRIOR_LEVEL,
	AP_SKILL_CONST_CHANGE_MONSTER,
	AP_SKILL_CONST_BLOCK_POINT,
	AP_SKILL_CONST_SKILL_BLOCK,
	AP_SKILL_CONST_STUN_TIME,
	AP_SKILL_CONST_STUN_GENERATE_TIME,
	AP_SKILL_CONST_CRITICAL,
	AP_SKILL_CONST_ATK_RANGE,
	AP_SKILL_CONST_SKILL_RANGE,
	AP_SKILL_CONST_SKILL_RATE,
	AP_SKILL_CONST_DAMAGE_CONVERT_HP,
	AP_SKILL_CONST_DAMAGE_CONVERT_MP,
	AP_SKILL_CONST_REGEN_HP,
	AP_SKILL_CONST_REGEN_MP,
	AP_SKILL_CONST_CHARGE_1,
	AP_SKILL_CONST_CHARGE_2,
	AP_SKILL_CONST_CHARGE_3,
	AP_SKILL_CONST_AGGRODOLL_HP,
	AP_SKILL_CONST_DOT_DAMAGE_TIME,
	AP_SKILL_CONST_COST_MP_DECREASE,
	AP_SKILL_CONST_CAST_TIME_DECREASE,
	AP_SKILL_CONST_SKILL_LEVELUP,
	AP_SKILL_CONST_MP_CONVERT_HP,
	AP_SKILL_CONST_DEATH,
	AP_SKILL_CONST_CONNECTION_TID,
	AP_SKILL_CONST_SKILL_UNION,
	AP_SKILL_CONST_SKILL_UNION_CONTROL,
	AP_SKILL_CONST_MAX_SKILL_UNION,
	AP_SKILL_CONST_SKILL_COST,
	AP_SKILL_CONST_SKILL_UPGRADE_COST,
	AP_SKILL_CONST_SKILL_CLASSIFY_ID,
	AP_SKILL_CONST_SKILL_CLASSIFY_LEVEL,
	AP_SKILL_CONST_VELOCITY,
	AP_SKILL_CONST_SUMMONS_TID,
	AP_SKILL_CONST_SUMMONS_COUNT,
	AP_SKILL_CONST_ADDITIONAL_DURATION,
	AP_SKILL_CONST_MAX_TARGET_NUM,
	AP_SKILL_CONST_LIMIT_QUANTITY,
	AP_SKILL_CONST_BONUS_EXP,
	AP_SKILL_CONST_BONUS_MONEY,
	AP_SKILL_CONST_BONUS_DROP_RATE,
	AP_SKILL_CONST_BONUS_DROP_RATE2,
	AP_SKILL_CONST_BONUS_CHARISMA_RATE,
	AP_SKILL_CONST_LEVEL_DIFF,
	AP_SKILL_CONST_DIVIDE_RATE,
	AP_SKILL_CONST_EA_DMG_PHYSICAL,
	AP_SKILL_CONST_EA_DMG_MAGIC,
	AP_SKILL_CONST_EA_DMG_WATER,
	AP_SKILL_CONST_EA_DMG_AIR,
	AP_SKILL_CONST_EA_DMG_EARTH,
	AP_SKILL_CONST_EA_DMG_FIRE,
	AP_SKILL_CONST_EA_DMG_POISON,
	AP_SKILL_CONST_EA_DMG_ICE,
	AP_SKILL_CONST_EA_DMG_THUNDER,
	AP_SKILL_CONST_EA_DMG_C,
	AP_SKILL_CONST_EA_DMG_PHYSICAL_PERCENT,
	AP_SKILL_CONST_EA_DMG_MAGIC_PERCENT,
	AP_SKILL_CONST_EA_DMG_WATER_PERCENT,
	AP_SKILL_CONST_EA_DMG_AIR_PERCENT,
	AP_SKILL_CONST_EA_DMG_EARTH_PERCENT,
	AP_SKILL_CONST_EA_DMG_FIRE_PERCENT,
	AP_SKILL_CONST_EA_DMG_POISON_PERCENT,
	AP_SKILL_CONST_EA_DMG_ICE_PERCENT,
	AP_SKILL_CONST_EA_DMG_THUNDER_PERCENT,
	AP_SKILL_CONST_EA_DMG_C_PERCENT,
	AP_SKILL_CONST_IGNORE_PHYSICAL_DEFENCE_PERCENT,
	AP_SKILL_CONST_IGNORE_ATTRIBUTE_DEFENCE_PERCENT,
	AP_SKILL_CONST_CRITICAL_DEFENCE_PERCENT,
	AP_SKILL_CONST_ARMOR_DURABILITY_PERCENT,
	AP_SKILL_CONST_ARMOR_DURABILITY_NUM,
	AP_SKILL_CONST_DAMAGE_B,
	AP_SKILL_CONST_DOT_DMG_B,
	AP_SKILL_CONST_REQUIRE_HEROIC_POINT,
	AP_SKILL_CONST_REQUIRE_CHARISMA_POINT,
	AP_SKILL_CONST_DAMAGE_HEROIC,
	AP_SKILL_CONST_DAMAGE_HEROIC_PERCENT,
	AP_SKILL_CONST_TIME_CONTROL,
	AP_SKILL_CONST_ITEM_PARTS,
	AP_SKILL_CONST_COUNT
};

enum ap_skill_effect_detail {
	AP_SKILL_EFFECT_DETAIL_UPDATE_COMBAT_POINT = 0,
	AP_SKILL_EFFECT_DETAIL_CONVERT,
	AP_SKILL_EFFECT_DETAIL_SKILL_LEVELUP,
	AP_SKILL_EFFECT_DETAIL_TWICE_PACKET,
	AP_SKILL_EFFECT_DETAIL_ACTION_ON_ACTION,
	AP_SKILL_EFFECT_DETAIL_AT_FIELD,
	AP_SKILL_EFFECT_DETAIL_SUMMONS,
	AP_SKILL_EFFECT_DETAIL_DURATION_TYPE,
	AP_SKILL_EFFECT_DETAIL_GAME_BONUS,
	AP_SKILL_EFFECT_DETAIL_GAME_EFFECT,
	AP_SKILL_EFFECT_DETAIL_FORCE,
	AP_SKILL_EFFECT_DETAIL_DISPEL,
	AP_SKILL_EFFECT_DETAIL_DIVIDE,
	AP_SKILL_EFFECT_DETAIL_DETECT,
	AP_SKILL_EFFECT_DETAIL_SKILL_UNION,
	AP_SKILL_EFFECT_DETAIL_MOVE_POS,
	AP_SKILL_EFFECT_DETAIL_REFLECT_MELEE_ATK,
	AP_SKILL_EFFECT_DETAIL_TARGET_RESTRICTION,
	AP_SKILL_EFFECT_DETAIL_DISTURB_CHARACTER_ACTION,
	AP_SKILL_EFFECT_DETAIL_TOLERANCE_DISTURB_CHARACTER_ACTION, 
	AP_SKILL_EFFECT_DETAIL_COUNT
};

enum ap_skill_type {
	AP_SKILL_TYPE_PHYSICAL_DAMAGE = 0,
	AP_SKILL_TYPE_CHANGE_FACTOR
};

enum ap_skill_status {
	AP_SKILL_STATUS_NOT_CAST = 0,
	AP_SKILL_STATUS_CAST_DELAY,
	AP_SKILL_STATUS_CAST,
};

enum ap_skill_action_type {
	AP_SKILL_ACTION_START_CAST_SKILL = 0,
	AP_SKILL_ACTION_CAST_SKILL,
	AP_SKILL_ACTION_CAST_SKILL_RESULT,
	AP_SKILL_ACTION_END_CAST_SKILL,
	AP_SKILL_ACTION_CANCEL_CAST_SKILL,
	AP_SKILL_ACTION_MISS_CAST_SKILL,
	AP_SKILL_ACTION_FAILED_CAST,
	AP_SKILL_ACTION_INVALID_TARGET,
	AP_SKILL_ACTION_NEED_REQUIREMENT,
	AP_SKILL_ACTION_NOT_ENOUGH_HP,
	AP_SKILL_ACTION_NOT_ENOUGH_MP,
	AP_SKILL_ACTION_NOT_ENOUGH_SP,
	AP_SKILL_ACTION_NOT_ENOUGH_ARROW,
	AP_SKILL_ACTION_NOT_ENOUGH_BOLT,
	AP_SKILL_ACTION_ALREADY_USE_SKILL,
	AP_SKILL_ACTION_NOT_READY_CAST,
	AP_SKILL_ACTION_INVALID_TARGET_TO_GATHER,
	AP_SKILL_ACTION_NOT_ENOUGH_PRODUCT,
	AP_SKILL_ACTION_BLOCK_CAST_SKILL,
	AP_SKILL_ACTION_TARGET_NUM_ZERO,
};

enum ap_skill_mastery_type {
	AP_SKILL_MASTERY_TYPE_NONE = 0,
	AP_SKILL_MASTERY_TYPE_ATTACK,
	AP_SKILL_MASTERY_TYPE_MAX
};

enum ap_skill_mastery_specialized_type {
	AP_SKILL_MASTERY_SPECIALIZED_NONE						= 0x00,
	AP_SKILL_MASTERY_SPECIALIZED_DECREASE_COST				= 0x01,
	AP_SKILL_MASTERY_SPECIALIZED_INCREASE_DMG				= 0x02,
	AP_SKILL_MASTERY_SPECIALIZED_INCREASE_DURATION			= 0x04,
	AP_SKILL_MASTERY_SPECIALIZED_INCREASE_TARGET_AREA		= 0x08,
	AP_SKILL_MASTERY_SPECIALIZED_INCREASE_TARGET_DISTANCE	= 0x10,
	AP_SKILL_MASTERY_SPECIALIZED_COUNT						= 0x05
};

enum ap_skill_weapon_damage_type {
	AP_SKILL_WEAPON_DAMAGE_TYPE_NORMAL = 0,
	AP_SKILL_WEAPON_DAMAGE_TYPE_MIN,
	AP_SKILL_WEAPON_DAMAGE_TYPE_MAX,
};

enum ap_skill_charge_level {
	AP_SKILL_CHARGE_NONE = 0,
	AP_SKILL_CHARGE_1,
	AP_SKILL_CHARGE_2,
	AP_SKILL_CHARGE_3,
};

enum ap_skill_additional_effect_type {
	AP_SKILL_ADDITIONAL_EFFECT_END_BUFF_EXPLOSION = 1,
	AP_SKILL_ADDITIONAL_EFFECT_TELEPORT,
	AP_SKILL_ADDITIONAL_EFFECT_ABSORB_MP,
	AP_SKILL_ADDITIONAL_EFFECT_ABSORB_HP,
	AP_SKILL_ADDITIONAL_EFFECT_CONVERT_MP,
	AP_SKILL_ADDITIONAL_EFFECT_CONVERT_HP,
	AP_SKILL_ADDITIONAL_EFFECT_RELEASE_TARGET,
	AP_SKILL_ADDITIONAL_EFFECT_LENS_STONE,
	AP_SKILL_ADDITIONAL_EFFECT_DETECT_SCROLL,
	AP_SKILL_ADDITIONAL_EFFECT_CURE
};

enum ap_skill_packet_type {
	AP_SKILL_PACKET_TYPE_ADD = 0,
	AP_SKILL_PACKET_TYPE_REMOVE,
	AP_SKILL_PACKET_TYPE_UPDATE,
	AP_SKILL_PACKET_TYPE_UPDATE_ATTACH_DATA,
	AP_SKILL_PACKET_TYPE_ADD_BUFFED_LIST,
	AP_SKILL_PACKET_TYPE_REMOVE_BUFFED_LIST,
	AP_SKILL_PACKET_TYPE_ALL_BUFFED_SKILL,
	AP_SKILL_PACKET_TYPE_CAST_SKILL,
	AP_SKILL_PACKET_TYPE_CAST_SKILL_RESULT,
	AP_SKILL_PACKET_TYPE_REAL_HIT,
	AP_SKILL_PACKET_TYPE_ADDITIONAL_EFFECT,
	AP_SKILL_PACKET_TYPE_UPDATE_DIRT_POINT,
	AP_SKILL_PACKET_TYPE_UPDATE_SKILL_POINT,
	AP_SKILL_PACKET_TYPE_REQUEST_SKILL_ROLLBACK,
	AP_SKILL_PACKET_TYPE_MODIFIED_SKILL_LEVEL,
	AP_SKILL_PACKET_TYPE_INIT_COOLTIME,
	AP_SKILL_PACKET_TYPE_SPECIFIC_SKILL_LEVEL,
};

enum ap_skill_module_data_index {
	AP_SKILL_MDI_SKILL = 0,
	AP_SKILL_MDI_TEMPLATE,
	AP_SKILL_MDI_SPECIALIZE,
	AP_SKILL_MDI_TOOLTIP,
	AP_SKILL_MDI_PRODUCT_TEMPLATE,
	AP_SKILL_MDI_BUFF,
	AP_SKILL_MDI_COUNT
};

enum ap_skill_callback_id {
	AP_SKILL_CB_RECEIVE,
	AP_SKILL_CB_ATTEMPT_CAST,
	AP_SKILL_CB_IS_VALID_TARGET,
	AP_SKILL_CB_ADD_BUFF,
	/** \brief Triggered just before buff is removed. */
	AP_SKILL_CB_REMOVE_BUFF,
};

struct ap_skill_action_data {
	enum ap_skill_action_type action_type;
	struct ap_character_action_info info;
	uint32_t skill_id;
	uint32_t skill_tid;
	uint32_t skilll_level;
	void * target_base[AP_SKILL_MAX_TARGET];
	uint32_t target_union;
	struct au_pos target_pos;
	int32_t target_hit_range;
	boolean force_attack;
	uint32_t cast_delay;
	uint32_t duration;
	uint32_t recast_delay;
	boolean is_factor_not_queueing;
	boolean update_now;
	uint32_t additional_effect;	
};

struct ap_skill_formula_arg {
	int32_t arg1;
	int32_t arg2;
	int32_t arg3;
	int32_t arg4;
	char argstr[128];
};

struct ap_skill_buff_list {
	uint32_t skill_id;
	uint32_t skill_tid;
	uint32_t skill_level;
	const struct ap_skill_template * temp;
	uint32_t caster_id;
	uint32_t caster_tid;
	uint32_t spell_count;
	uint32_t duration_ms;
	uint64_t end_tick;
	uint32_t charge_level;
	uint32_t expire_time;
	boolean is_ony_update;
};

struct ap_skill_buffed_combat_effect_arg {
	int32_t melee_critical_rate;
	int32_t melee_critical_damage_adjust_rate;
	int32_t magic_critical_rate;
	int32_t magic_damage_adjust_rate;
	int32_t death_rate;
	int32_t death_amount;
	int32_t counter_attack_rate;
	int32_t weapon_damage_type;
	int32_t block_rate;
	int32_t damage_to_hp_rate[2];
	int32_t damage_to_mp_rate[2];
	int32_t damage_to_hp_amount[2];
	int32_t damage_to_mp_amount[2];
	int32_t charge_level;
	int32_t charge_damage;
	int32_t skill_level_up_point;
	int32_t char_level_up_point;
	int32_t damage_reflect_rate;
	int32_t damage_reflect_amount;
	int32_t damage_ignore_rate;
	int32_t heroic_damage_reflect_rate;
	int32_t heroic_damage_reflect_amount;
	int32_t stun_protect_rate;
	int32_t action_on_action_type3_count;
	int32_t action_on_action_type4_count;
	int32_t increase_summon_limit;
	int32_t summons_type5_count;
	int32_t divide_attr_rate;
	int32_t divide_attr_caster;
	int32_t divide_normal_rate;
	int32_t divide_normal_caster;
	int32_t ignore_physical_defense;
	int32_t ignore_attribute_defense;
	int32_t critical_hit_resistance;
};

struct ap_skill_buffed_factor_effect_arg {
	int32_t cost_hp;
	int32_t cost_hp_rate;
	int32_t cost_mp;
	int32_t cost_mp_rate;
	int32_t cost_sp;
	int32_t cost_sp_rate;
	int32_t cast_time;
	int32_t cast_time_rate;
	int32_t duration;
	int32_t hp_regen;
	int32_t mp_regen;
	int32_t range_adust_percent;
	boolean added_update_factor_item[15];
	int32_t bonus_exp_rate;
	int32_t bonus_gold_rate;
	int32_t bonus_drop_rate;
	int32_t bonus_rare_drop_rate;
	int32_t bonus_charisma_rate;
};

/** \brief struct ap_character attachment. */
struct ap_skill_character {
	uint32_t skill_count;
	uint32_t skill_id[AP_SKILL_MAX_SKILL_OWN];
	struct ap_skill * skill[AP_SKILL_MAX_SKILL_OWN];
	uint64_t last_buff_process_tick;
	uint32_t buff_count;
	struct ap_skill_buff_list buff_list[AP_SKILL_MAX_SKILL_BUFF];
	uint32_t use_skill_id[AP_SKILL_MAX_SKILL_USE];
	uint32_t use_passive_skill_id[AP_SKILL_MAX_SKILL_USE];
	struct ap_skill * use_skill[AP_SKILL_MAX_SKILL_USE];
	struct ap_skill * use_passive_skill[AP_SKILL_MAX_SKILL_USE];
	uint64_t defense_type_effect;
	int32_t melee_defense_point;
	int32_t melee_reflect_point;
	int32_t magic_defense_point;
	int32_t magic_reflect_point;
	int32_t damage_shield;
	uint64_t combat_effect;
	uint64_t combat_effect2;
	struct ap_skill_buffed_combat_effect_arg combat_effect_arg;
	boolean sync_combat_effect_arg;
	uint64_t factor_effect;
	uint64_t factor_effect2;
	struct ap_skill_buffed_factor_effect_arg factor_effect_arg;
	uint16_t skill_effect_detail[AP_SKILL_EFFECT_DETAIL_COUNT];
	int32_t modify_char_level;
	int32_t modify_skill_level;
	boolean specialize_level_point[AP_SKILL_MAX_SPECIALIZE_LEVEL_POINT];
	uint32_t available_specialize_count;
	uint32_t wrong_spell_count;
	uint32_t last_cast_twice_skill_id[AP_SKILL_MAX_TWICE_PACKET_BUFFER];
	struct ap_grid * mastery_grid[AP_SKILL_MAX_MASTERY][AP_SKILL_MAX_MASTERY];
	struct ap_grid * mastery_specialize_grid[AP_SKILL_MAX_MASTERY];
	int32_t melee_combo_in_charge;
	uint32_t skill_union_count;
	uint32_t extra_skill_union;
};

struct ap_skill_template_attach_data {
	char usable_skill_name[AP_SKILL_MAX_SKILL_OWN][AP_SKILL_MAX_SKILL_NAME_LENGTH + 1];
	char default_template_name[AP_SKILL_MAX_DEFAULT_SKILL][AP_SKILL_MAX_SKILL_NAME_LENGTH + 1];
};

struct ap_skill_specialize_template {
	enum ap_base_type base_type;
	uint32_t id;
	char name[AP_SKILL_MAX_SPECIALIZE_NAME];
	char description[AP_SKILL_MAX_SPECIALIZE_DESCRIPTION];
	char restriction[AP_SKILL_MAX_SPECIALIZE_RESTRICTION];
	uint32_t duration;
	struct ap_grid_item * grid_item;
};

struct ap_skill_template {
	enum ap_base_type base_type;
	uint32_t id;
	char name[AP_SKILL_MAX_SKILL_NAME_LENGTH + 1];
	char below_level_skill_name[AP_SKILL_MAX_SKILL_NAME_LENGTH + 1];
	uint64_t attribute;
	uint64_t target_type;
	uint64_t range_type;
	uint64_t range_type2;
	uint64_t requirement_type;
	uint64_t cost_type;
	uint64_t special_status;
	uint32_t special_status_adjust_type;
	uint64_t special_status_matching;
	boolean is_special_status_matching_all;
	uint64_t condition_type;
	struct ap_skill_formula_arg condition_arg;
	uint64_t effect_type;
	uint64_t process_interval_effect_type;
	uint64_t effect_type2;
	uint64_t process_interval_effect_type2;
	uint16_t effect_detail_type[AP_SKILL_EFFECT_DETAIL_COUNT];
	uint16_t process_interval_effect_detail_type[AP_SKILL_EFFECT_DETAIL_COUNT];
	uint64_t end_effect_type;
	uint32_t condition2;
	struct au_dirt use_dirt_point;
	float used_const_factor[AP_SKILL_MAX_SKILL_CAP][AP_SKILL_CONST_COUNT];
	boolean available_const_factor[AP_SKILL_MAX_SKILL_CAP];
	float used_const_factor2[AP_SKILL_MAX_SKILL_CAP][AP_SKILL_CONST_COUNT];
	boolean available_const_factor2[AP_SKILL_MAX_SKILL_CAP];
	boolean is_shrine_skill;
	boolean is_sigil_skill;
	boolean is_twice_packet;
	struct ap_grid_item * grid_item;
	struct ap_grid_item * alarm_grid_item;
	uint16_t grid_row;
	uint16_t grid_col;
	boolean is_auto_attack;
	uint32_t creature_tid[AP_SKILL_MAX_SKILL_CAP][AP_SKILL_MAX_CREATURE_TID_NUM];
	uint32_t  * additional_skill_tid[AP_SKILL_MAX_SKILL_CAP];
	uint32_t level_up_skill_tid[AP_SKILL_MAX_SKILL_CAP][AP_SKILL_MAX_SKILL_LEVELUP_TID];
	uint32_t level_up_skill_count[AP_SKILL_MAX_SKILL_CAP];
	uint32_t limited_max_level;
	boolean is_high_level_skill;
	boolean is_heroic_skill;
};

struct ap_skill {
	enum ap_base_type base_type;
	uint32_t id;
	uint32_t tid;
	struct ap_factor factor;
	int32_t target_union;
	struct au_pos target_pos;
	int32_t target_hit_range;
	struct ap_skill_template * temp;
	enum ap_skill_status status;
	boolean force_attack;
	/** \brief 
	 * If TRUE, this skill will not be included in the 
	 * database and will no longer be available when 
	 * character is next loaded (i.e. ArchLord skills). */
	boolean is_temporary;
	uint64_t start_tick;
	uint64_t end_tick;
	uint64_t cooldown_tick;
	uint32_t interval;
	uint64_t next_process_tick;
	uint32_t cast_delay;
	uint32_t recast_delay;
	int32_t mastery_index;
	int32_t active_skill_point;
	int32_t max_input_skill_point;
	struct ap_grid_item * grid_item;
	uint32_t modified_level;

	struct ap_skill * next;
};

struct ap_skill_cast_info {
	uint32_t skill_id;
	uint32_t target_id;
	uint64_t complete_tick;
	boolean force_attack;
	boolean follow_target;
	boolean within_range;
	struct au_pos target_pos;
	float range;
	/** \brief Skill cast time in milliseconds. */
	uint32_t cast_time;
	/** \brief Skill cooldown time in milliseconds. */
	uint32_t cooldown_time;
	/** \brief Skill duration in milliseconds. */
	uint32_t duration_time;
	uint32_t targets[AP_SKILL_MAX_TARGET];
	uint16_t target_count;
};

struct ap_skill_base_packet {
	enum ap_base_type base_type;
	uint32_t id;
};

struct ap_skill_action_packet {
	enum ap_skill_action_type action_type;
	struct ap_skill_base_packet * target;
	struct au_pos dest_pos;
	boolean forced_attack;
};

/** \brief AP_SKILL_CB_RECEIVE callback data. */
struct ap_skill_cb_receive {
	enum ap_skill_packet_type type;
	uint32_t skill_id;
	uint32_t skill_tid;
	struct ap_skill_action_packet * action_packet;
	void * user_data;
};

/** \brief AP_SKILL_CB_ATTEMPT_CAST callback data. */
struct ap_skill_cb_attempt_cast {
	struct ap_character * character;
	struct ap_skill * skill;
	uint64_t tick;
};

/** \brief AP_SKILL_CB_IS_VALID_TARGET callback data. */
struct ap_skill_cb_is_valid_target {
	struct ap_character * character;
	struct ap_character * target;
	struct ap_skill * skill;
};

/** \brief AP_SKILL_CB_ADD_BUFF callback data. */
struct ap_skill_cb_add_buff {
	struct ap_character * character;
	struct ap_skill_buff_list * buff;
};

/** \brief AP_SKILL_CB_REMOVE_BUFF callback data. */
struct ap_skill_cb_remove_buff {
	struct ap_character * character;
	struct ap_skill_buff_list * buff;
};

struct ap_skill_module * ap_skill_create_module();

boolean ap_skill_read_templates(
	struct ap_skill_module * mod,
	const char * file_path, 
	boolean decrypt);

boolean ap_skill_read_spec(
	struct ap_skill_module * mod,
	const char * file_path, 
	boolean decrypt);

boolean ap_skill_read_const(
	struct ap_skill_module * mod,
	const char * file_path, 
	boolean decrypt);

boolean ap_skill_read_const2(
	struct ap_skill_module * mod,
	const char * file_path, 
	boolean decrypt);

struct ap_skill * ap_skill_new(struct ap_skill_module * mod);

void ap_skill_free(struct ap_skill_module * mod, struct ap_skill * skill);

void ap_skill_add_callback(
	struct ap_skill_module * mod,
	enum ap_skill_callback_id id,
	ap_module_t callback_module,
	ap_module_default_t callback);

size_t ap_skill_attach_data(
	struct ap_skill_module * mod,
	enum ap_skill_module_data_index data_index,
	size_t data_size,
	ap_module_t callback_module,
	ap_module_default_t constructor,
	ap_module_default_t destructor);

void ap_skill_add_stream_callback(
	struct ap_skill_module * mod,
	enum ap_skill_module_data_index data_index,
	const char * module_name,
	ap_module_t callback_module,
	ap_module_stream_read_t read_cb,
	ap_module_stream_write_t write_cb);

struct ap_skill_template * ap_skill_get_template(
	struct ap_skill_module * mod,
	uint32_t tid);

struct ap_skill_template * ap_skill_get_template_by_name(
	struct ap_skill_module * mod,
	const char * name);

struct ap_skill_character * ap_skill_get_character(
	struct ap_skill_module * mod,
	struct ap_character * character);

float ap_skill_get_cast_range(
	struct ap_skill_module * mod,
	struct ap_character * character,
	struct ap_skill * skill);

uint32_t ap_skill_get_modified_level(
	struct ap_skill_module * mod,
	struct ap_character * character,
	const struct ap_skill * skill);

const float * ap_skill_get_const_factor(
	struct ap_skill_module * mod,
	struct ap_character * character,
	const struct ap_skill * skill);

struct ap_skill * ap_skill_find(
	struct ap_skill_module * mod,
	struct ap_character * character,
	uint32_t skill_id);

struct ap_skill * ap_skill_find_by_tid(
	struct ap_skill_module * mod,
	struct ap_character * character,
	uint32_t skill_tid);

boolean ap_skill_attempt_cast(
	struct ap_skill_module * mod,
	struct ap_character * character,
	struct ap_skill * skill);

boolean ap_skill_is_valid_target(
	struct ap_skill_module * mod,
	struct ap_character * character,
	struct ap_character * target,
	struct ap_skill * skill,
	boolean force_attack);

boolean ap_skill_is_stronger_effect_applied(
	struct ap_skill_module * mod,
	struct ap_character * character,
	const struct ap_skill_template * temp,
	uint32_t skill_level);

boolean ap_skill_is_stronger_or_equal_effect_applied(
	struct ap_skill_module * mod,
	struct ap_character * character,
	const struct ap_skill_template * temp,
	uint32_t skill_level);

struct ap_skill_buff_list * ap_skill_add_buff(
	struct ap_skill_module * mod, 
	struct ap_character * character,
	uint32_t skill_id,
	uint32_t skill_level,
	const struct ap_skill_template * temp,
	uint32_t duration,
	uint32_t caster_id,
	uint32_t caster_tid);

uint32_t ap_skill_remove_buff(
	struct ap_skill_module * mod, 
	struct ap_character * character,
	uint32_t buff_index);

boolean ap_skill_check_buff_condition(
	struct ap_skill_module * mod, 
	const struct ap_skill_buff_list * buff);

boolean ap_skill_on_receive(
	struct ap_skill_module * mod,
	const void * data,
	uint16_t length,
	void * user_data);

void ap_skill_make_add_packet(
	struct ap_skill_module * mod,
	struct ap_skill * skill,
	struct ap_character * character);

void ap_skill_make_add_packet_buffer(
	struct ap_skill_module * mod,
	struct ap_skill * skill,
	struct ap_character * character,
	void * buffer,
	uint16_t * length);

void ap_skill_make_update_packet(
	struct ap_skill_module * mod,
	struct ap_skill * skill,
	struct ap_character * character);

void ap_skill_make_update_attached_data_packet(
	struct ap_skill_module * mod,
	struct ap_character * character);

void ap_skill_make_add_buffed_list_packet(
	struct ap_skill_module * mod,
	struct ap_character * character,
	const struct ap_skill_buff_list * buff);

void ap_skill_make_remove_buffed_list_packet(
	struct ap_skill_module * mod,
	struct ap_character * character,
	struct ap_skill_buff_list * buff);

void ap_skill_make_cast_packet(
	struct ap_skill_module * mod,
	struct ap_skill * skill,
	struct ap_character * character,
	struct ap_character * target,
	const struct ap_skill_cast_info * cast_info);

void ap_skill_make_cast_result_packet(
	struct ap_skill_module * mod,
	struct ap_character * character,
	struct ap_skill_action_data * action);

void ap_skill_make_cast_result_packet(
	struct ap_skill_module * mod,
	struct ap_character * character,
	struct ap_skill_action_data * action);

void ap_skill_make_additional_effect_packet(
	struct ap_skill_module * mod,
	struct ap_skill * skill,
	struct ap_character * character,
	uint32_t target_id,
	uint32_t additional_effect);

void ap_skill_make_modified_skill_level_packet(
	struct ap_skill_module * mod,
	struct ap_character * character);

void ap_skill_make_init_cooltime_packet(
	struct ap_skill_module * mod,
	struct ap_character * character,
	struct ap_skill * skill);

static inline uint32_t ap_skill_get_required_class(
	enum au_race_type race, enum au_char_class_type class_)
{
	switch (race) {
	case AU_RACE_TYPE_HUMAN:
		switch (class_) {
		case AU_CHARCLASS_TYPE_KNIGHT:
			return AP_SKILL_CONST_REQUIRE_CLASS_KNIGHT;
		case AU_CHARCLASS_TYPE_RANGER:
			return AP_SKILL_CONST_REQUIRE_CLASS_ARCHER;
		case AU_CHARCLASS_TYPE_MAGE:
			return AP_SKILL_CONST_REQUIRE_CLASS_WIZARD;
		default:
			return AP_SKILL_CONST_COUNT;
		}
	case AU_RACE_TYPE_ORC:
		switch (class_) {
		case AU_CHARCLASS_TYPE_KNIGHT:
			return AP_SKILL_CONST_REQUIRE_CLASS_BERSERKER;
		case AU_CHARCLASS_TYPE_RANGER:
			return AP_SKILL_CONST_REQUIRE_CLASS_HUNTER;
		case AU_CHARCLASS_TYPE_MAGE:
			return AP_SKILL_CONST_REQUIRE_CLASS_SORCERER;
		default:
			return AP_SKILL_CONST_COUNT;
		}
	case AU_RACE_TYPE_MOONELF:
		switch (class_) {
		case AU_CHARCLASS_TYPE_KNIGHT:
			return AP_SKILL_CONST_REQUIRE_CLASS_SWASHBUCKLER;
		case AU_CHARCLASS_TYPE_RANGER:
			return AP_SKILL_CONST_REQUIRE_CLASS_RANGER;
		case AU_CHARCLASS_TYPE_MAGE:
			return AP_SKILL_CONST_REQUIRE_CLASS_ELEMENTALER;
		default:
			return AP_SKILL_CONST_COUNT;
		}
	default:
		return AP_SKILL_CONST_COUNT;
	}
}

static inline uint32_t ap_skill_get_level(const struct ap_skill * skill)
{
	return skill->factor.dirt.skill_level;
}

static inline const float * ap_skill_get_const_factor_template(
	const struct ap_skill_template * temp,
	uint32_t skill_level)
{
	assert(skill_level < AP_SKILL_MAX_SKILL_CAP);
	return &temp->used_const_factor[skill_level][0];
}

static inline const float * ap_skill_get_buff_const_factor(
	const struct ap_skill_buff_list * buff)
{
	assert(buff->skill_level < AP_SKILL_MAX_SKILL_CAP);
	return &buff->temp->used_const_factor[buff->skill_level][0];
}

static inline const float * ap_skill_get_buff_const_factor2(
	const struct ap_skill_buff_list * buff)
{
	assert(buff->skill_level < AP_SKILL_MAX_SKILL_CAP);
	return &buff->temp->used_const_factor2[buff->skill_level][0];
}

static inline uint32_t ap_skill_get_exp(const struct ap_skill * skill)
{
	return skill->factor.dirt.skill_exp;
}

static inline boolean ap_skill_inflicts_instant_damage(
	const struct ap_skill * skill)
{
	const struct ap_skill_template * t = skill->temp;
	uint32_t bits = 
		AP_SKILL_EFFECT_MELEE_ATTACK_DMG_TYPE1 |
		AP_SKILL_EFFECT_MELEE_ATTACK_DMG_TYPE2 |
		AP_SKILL_EFFECT_MELEE_ATTACK_DMG_TYPE3 |
		AP_SKILL_EFFECT_MELEE_ATTACK_DMG_TYPE6 |
		AP_SKILL_EFFECT_MELEE_ATTACK_HEROIC;
	if (!(t->effect_type & AP_SKILL_EFFECT_MELEE_ATTACK_DMG))
		return FALSE;
	if (!(t->effect_type & bits))
		return FALSE;
	return TRUE;
}

static inline boolean ap_skill_is_offensive(const struct ap_skill * skill)
{
	const struct ap_skill_template * t = skill->temp;
	uint32_t bits = 
		AP_SKILL_ATTRIBUTE_PHYSICAL_DMG |
		AP_SKILL_ATTRIBUTE_MAGIC_DMG_MAGIC |
		AP_SKILL_ATTRIBUTE_MAGIC_DMG_FIRE |
		AP_SKILL_ATTRIBUTE_MAGIC_DMG_EARTH |
		AP_SKILL_ATTRIBUTE_MAGIC_DMG_AIR |
		AP_SKILL_ATTRIBUTE_MAGIC_DMG_WATER |
		AP_SKILL_ATTRIBUTE_DEBUFF;
	if (t->attribute & bits)
		return TRUE;
	if ((t->effect_type & AP_SKILL_EFFECT_DISPEL_MAGIC) &&
		(t->effect_detail_type[AP_SKILL_EFFECT_DETAIL_DISPEL] & AP_SKILL_EFFECT_DETAIL_DISPEL_ALL_BUFF)) {
		return TRUE;
	}
	if (ap_skill_inflicts_instant_damage(skill))
		return TRUE;
	return FALSE;
}

static inline boolean ap_skill_check_effect(
	const struct ap_skill * skill,
	uint64_t effect_type,
	enum ap_skill_effect_detail detail_type,
	uint32_t detail_bit)
{
	const struct ap_skill_template * t = skill->temp;
	assert(detail_type >= 0 && detail_type < AP_SKILL_EFFECT_DETAIL_COUNT);
	if (!CHECK_BIT(t->effect_type, effect_type))
		return FALSE;
	if (!CHECK_BIT(t->effect_detail_type[detail_type], detail_bit))
		return FALSE;
	return TRUE;
}

static inline boolean ap_skill_check_effect2(
	const struct ap_skill * skill,
	uint64_t effect_type2,
	enum ap_skill_effect_detail detail_type,
	uint32_t detail_bit)
{
	const struct ap_skill_template * t = skill->temp;
	assert(detail_type >= 0 && detail_type < AP_SKILL_EFFECT_DETAIL_COUNT);
	if (!CHECK_BIT(t->effect_type2, effect_type2))
		return FALSE;
	if (!CHECK_BIT(t->effect_detail_type[detail_type], detail_bit))
		return FALSE;
	return TRUE;
}

static inline boolean ap_skill_is_buff(const struct ap_skill_template * temp)
{
	return ((temp->attribute & AP_SKILL_ATTRIBUTE_BUFF) || 
		(temp->attribute & AP_SKILL_ATTRIBUTE_DEBUFF));
}

static inline boolean ap_skill_is_passive(const struct ap_skill_template * temp)
{
	return ((temp->attribute & AP_SKILL_ATTRIBUTE_PASSIVE) != 0);
}

static inline uint32_t ap_skill_get_classify_id(
	const struct ap_skill_template * temp,
	uint32_t skill_level)
{
	assert(skill_level < AP_SKILL_MAX_SKILL_CAP);
	return (uint32_t)temp->used_const_factor[skill_level][AP_SKILL_CONST_SKILL_CLASSIFY_ID];
}

static inline uint32_t ap_skill_get_classify_level(
	const struct ap_skill_template * temp,
	uint32_t skill_level)
{
	assert(skill_level < AP_SKILL_MAX_SKILL_CAP);
	return (uint32_t)temp->used_const_factor[skill_level][AP_SKILL_CONST_SKILL_CLASSIFY_LEVEL];
}

static inline uint32_t ap_skill_get_skill_union(
	const struct ap_skill_template * temp,
	uint32_t skill_level)
{
	assert(skill_level < AP_SKILL_MAX_SKILL_CAP);
	return (uint32_t)temp->used_const_factor[skill_level][AP_SKILL_CONST_SKILL_UNION];
}

static inline boolean ap_skill_is_buff_list_full(
	const struct ap_skill_character * attachment)
{
	return (attachment->buff_count >= AP_SKILL_MAX_SKILL_BUFF);
}

static inline boolean ap_skill_has_detail(
	const struct ap_skill_template * temp,
	enum ap_skill_effect_detail detail,
	uint32_t value)
{
	assert(detail >= 0 && detail < AP_SKILL_EFFECT_DETAIL_COUNT);
	return ((temp->effect_detail_type[detail] & value) != 0);
}

static inline boolean ap_skill_has_effect2_and_detail(
	const struct ap_skill_template * temp,
	uint64_t effect2_type,
	enum ap_skill_effect_detail detail,
	uint32_t value)
{
	assert(detail >= 0 && detail < AP_SKILL_EFFECT_DETAIL_COUNT);
	return (CHECK_BIT(temp->effect_type2, effect2_type) && 
		(CHECK_BIT(temp->effect_detail_type[detail], value)));
}

END_DECLS

#endif /* _AP_SKILL_H_ */
